<!doctype html><html lang=en-us><head><title>Ghost on Amazon EC2 without using sudo // A fractal spectrum of tales</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.120.4"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Marcello Seri"><meta name=description content="Free thoughts of a geeky mathematician"><meta http-equiv=Permissions-Policy content="interest-cohort=()"><link rel=stylesheet href=https://www.mseri.me/css/main.min.4e2016cf62779480fbe7ba44c261abc7b3a9744838af7268702179daa31e0716.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Ghost on Amazon EC2 without using sudo"><meta name=twitter:description content="I&rsquo;ve been thinking since yesterday&rsquo;s post how to run the ghost blog at the user level, wihout the need of using sudo.
Use Nginx In a production environment I would probably run ghos as a nginx subdomain (i.e. ghost.mseri.me), eventually forwarding the domain to the same address (e.g. typing mseri.me you would end up automatically in ghost.mseri.me). For this purpose you either know by hearth how to do it, or you can follow one of the many tutorial available online."><meta property="og:title" content="Ghost on Amazon EC2 without using sudo"><meta property="og:description" content="I&rsquo;ve been thinking since yesterday&rsquo;s post how to run the ghost blog at the user level, wihout the need of using sudo.
Use Nginx In a production environment I would probably run ghos as a nginx subdomain (i.e. ghost.mseri.me), eventually forwarding the domain to the same address (e.g. typing mseri.me you would end up automatically in ghost.mseri.me). For this purpose you either know by hearth how to do it, or you can follow one of the many tutorial available online."><meta property="og:type" content="article"><meta property="og:url" content="https://www.mseri.me/ghost-on-amazon-ec2-without-using-sudo/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2013-09-24T11:00:00+00:00"><meta property="article:modified_time" content="2013-10-29T15:56:32+00:00"></head><body><header class=app-header><a href=https://www.mseri.me><img class=app-header-avatar src=/images/gauss_logo.png alt="Marcello Seri"></a><h1>A fractal spectrum of tales</h1><p>Free thoughts of a geeky mathematician</p><div class=app-header-social><a target=_blank href=https://github.com/mseri rel="noreferrer noopener me"><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://mathstodon.xyz/@mseri rel="noreferrer noopener me"><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-mastodon"><title>mastodon</title><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18.648 15.254C16.832 17.017 12 16.88 12 16.88a18.262 18.262.0 01-3.288-.256c1.127 1.985 4.12 2.81 8.982 2.475-1.945 2.013-13.598 5.257-13.668-7.636L4 10.309c0-3.036.023-4.115 1.352-5.633C7.023 2.766 12 3.01 12 3.01s4.977-.243 6.648 1.667C19.977 6.195 20 7.274 20 10.31s-.456 4.074-1.352 4.944z"/><path d="M12 11.204V8.278C12 7.02 11.105 6 10 6S8 7.02 8 8.278V13m4-4.722C12 7.02 12.895 6 14 6s2 1.02 2 2.278V13"/></svg></a><a target=_blank href=https://twitter.com/marcelloseri rel="noreferrer noopener me"><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a target=_blank href=https://academic.mseri.me rel="noreferrer noopener me"><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-award"><title>award</title><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg></a></div><div style=margin-top:30px><h3 style=margin-bottom:10px>My podcasts</h4><a href=https://podcasters.spotify.com/pod/show/not-just-numbers><img src=/images/njn.jpg alt="Cover of the pocast it's not just numbers" class=image width=105px>
</a>&nbsp;
<a href=https://linktr.ee/degreesoffreedom><img src=/images/dof.jpg alt="Cover of the podcast degrees of freedom" class=image width=105px></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Ghost on Amazon EC2 without using sudo</h1><div class=post-meta><div><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Sep 24, 2013</div><div><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>4 min read</div><div><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><a class=tag href=https://www.mseri.me/tags/nginx/>nginx</a><a class=tag href=https://www.mseri.me/tags/forever/>forever</a><a class=tag href=https://www.mseri.me/tags/security/>security</a><a class=tag href=https://www.mseri.me/tags/iptables/>iptables</a></div></div></header><div class=post-content><p>I&rsquo;ve been thinking since <a href=https://www.mseri.me/ghost-up-and-running-on-amazon-ec2/>yesterday&rsquo;s post</a> how to run the ghost blog at the user level, wihout the need of using sudo.</p><h2 id=use-nginx>Use Nginx</h2><p>In a production environment I would probably run ghos as a nginx subdomain (i.e. <em>ghost.mseri.me</em>), eventually forwarding the domain to the same address (e.g. typing <em>mseri.me</em> you would end up automatically in <em>ghost.mseri.me</em>). For this purpose you either know by hearth how to do it, or you can follow one of the many tutorial available online. I think this is a very neat and effective way of proceeding.</p><p>For the sake of completeness I link some of them here:</p><ul><li><a href=https://blog.igbuend.com/dude-looks-like-a-ghost/>Dude looks like a ghost</a></li><li><a href=https://web.archive.org/web/20131021214247/https://nls.io/setup-ghost-with-nginx-on-debian/>Setup Ghost with nginx on Debian</a></li><li>Installing Node.js on Amazon EC2 (used to be github.com/d5/docs/wiki/Installing-Node.js-on-Amazon-EC2 but does no longer exist)</li><li><a href=https://www.howtoinstallghost.com/how-to-host-ghost-on-a-nginx-subdomain/>How to Host Ghost on a Nginx Subdomain</a></li></ul><p>Even if some of these links are for other Unix systems or just for node instead of ghost, it is pretty straightforward to adapt them to your needs.</p><p>Remember, when you are in a production environment, end even when you are just on a test space, to try and secture your system as possible. A decent starting point could be <a href=https://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html>Top 20 Nginx WebServer Best Security Practices</a> or <a href=https://blog.igbuend.com/dude-looks-like-a-ghost/>Dude looks like a ghost</a>. Moreover, if you are following this last tutorial you should have a look to <a href=https://snippets.aktagon.com/snippets/554-how-to-secure-an-nginx-server-with-fail2ban>How to Secure an nginx Server with Fail2Ban</a>.</p><h2 id=use-iptables-to-forward-port-80>Use iptables to forward port 80</h2><p>Another option, given that in Amazon EC2 users are allowed to use only port greater 1024, is to forward your 80 port to your 8080 (or whatever you need) using iptables.</p><p>If you set up ghost to listen on the port 8080, it&rsquo;s likely that you have nothing to do and port 80 and 8080 are already assigned to http. You can easily check it from the AWS Console (look for security groups) or simply <strong>giving it a try</strong>. Just modify your <code>config.js</code> and replace whatever is in <code>host: 2368</code> with <code>host: 8080</code>. Run ghost with <code>npm start</code> and try to access your blog, if it works there is nothing else to do than install <code>forever</code> and use it.</p><p><img src=/images/03-screenshot.png alt="The AWS console"></p><p>If it doesn&rsquo;t work try to execute the following command (only for linux) in a terminal and it should start working</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>    sudo iptables -t nat -A PREROUTING -p tcp --dport <span style=color:#ae81ff>80</span> -j REDIRECT --to-port <span style=color:#ae81ff>8080</span>
</span></span></code></pre></div><p>If you are still using port 2360 replace 8080 with the appropriate value. You may need to enable the access to the proper ports, to do it is enough to execute the following.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>    sudo iptables -A INPUT -p tcp --dport <span style=color:#ae81ff>80</span> -j ACCEPT
</span></span><span style=display:flex><span>    sudo iptables -A INPUT -p tcp --dport <span style=color:#ae81ff>8080</span> -j ACCEPT
</span></span></code></pre></div><p>I reccomend to <strong>not play with iptables rules in a production environment if you don&rsquo;t know what you are doing</strong>.</p><p>To check if the rules have been accepted you can list the configuration with</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>    sudo iptables -L
</span></span></code></pre></div><p>and to delete the previous rules in case they didn&rsquo;t work just type them again in the terminal with <code>-A</code> replaced by <code>-D</code>.</p><p>This same procedure can be adapted to other unix systems just using the appropriate firewall rules (like packet filter on BSD).</p><h2 id=install-and-use-forever>Install and use forever</h2><p>Now that we can start ghost without any need of using sudo, we only have to install forever. Open a terminal and execute</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>    sudo /usr/local/bin/npm install -g forever
</span></span></code></pre></div><p>then enter in the ghost folder with <code>cd path_to_your/ghost_folder</code> and run</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>    NODE_ENV<span style=color:#f92672>=</span>production forever start index.js
</span></span></code></pre></div><p>Open your browser and enjoy your Ghost Blog!</p><p><em>If you are using the development configuration instead of the production one, just drop <code>NODE_ENV=production</code> from the previous command.</em></p><p>To kill the server, just use</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>    forever list
</span></span><span style=display:flex><span>    forever stop <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>where 0 is the ghost process. Or eventually</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>    forever stopall
</span></span></code></pre></div><h3 id=check-permissions>Check permissions</h3><p>If you were running your ghost blog using sudo, you may not be able to access the database or some folders. In such case is enough to fix its permissions. Open a terminal, enter in the ghost folder with <code>cd path_to_your/ghost_folder</code> and execute</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>    sudo chown yourusername -R *
</span></span><span style=display:flex><span>    sudo chgrp yourusergroup -R *
</span></span></code></pre></div><p>where you have to replace <code>yourusername</code> and <code>yourusergroup</code> with the appropriate values. For Amazon EC2 the are in general both equal to <code>ec2-user</code>.</p></div><div class=post-footer></div></article></main></body></html>