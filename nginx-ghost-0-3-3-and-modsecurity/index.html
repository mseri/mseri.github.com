<!doctype html>
<html lang="en-us">
  <head>
    <title>nginx, ghost 0.3.3 and modsecurity // A fractal spectrum of tales</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.68.3" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Marcello Seri" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://www.mseri.me/css/main.min.4e2016cf62779480fbe7ba44c261abc7b3a9744838af7268702179daa31e0716.css" />

    
<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-44365202-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="nginx, ghost 0.3.3 and modsecurity"/>
<meta name="twitter:description" content="In my previous post, Ghost on Amazon EC2 without using sudo, I was proposing some way of running ghost without having to use sudo and with at least a minimal eye on security.
If you have followed one of the guides that I suggested, namely Dude Looks Like a Ghost, or you have installed your own modsecurity configuration you should have received a big page announcing an Error 403 right after the update of your ghost to version 0."/>

    <meta property="og:title" content="nginx, ghost 0.3.3 and modsecurity" />
<meta property="og:description" content="In my previous post, Ghost on Amazon EC2 without using sudo, I was proposing some way of running ghost without having to use sudo and with at least a minimal eye on security.
If you have followed one of the guides that I suggested, namely Dude Looks Like a Ghost, or you have installed your own modsecurity configuration you should have received a big page announcing an Error 403 right after the update of your ghost to version 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.mseri.me/nginx-ghost-0-3-3-and-modsecurity/" />
<meta property="article:published_time" content="2013-10-18T11:00:00+00:00" />
<meta property="article:modified_time" content="2013-10-29T15:59:25+00:00" />


    
  </head>
  <body>
    <header class="app-header">
      <a href="https://www.mseri.me"><img class="app-header-avatar" src="/images/gauss_logo.png" alt="Marcello Seri" /></a>
      <h1>A fractal spectrum of tales</h1>
      <p>Free thoughts of a geeky mathematician</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/mseri" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://twitter.com/marcelloseri" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg></a>
        
          <a target="_blank" href="https://academic.mseri.me" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-award">
  <title>award</title>
  <circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">nginx, ghost 0.3.3 and modsecurity</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Oct 18, 2013
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://www.mseri.me/tags/nginx/">nginx</a><a class="tag" href="https://www.mseri.me/tags/modsecurity/">modsecurity</a><a class="tag" href="https://www.mseri.me/tags/fix/">fix</a><a class="tag" href="https://www.mseri.me/tags/ghost/">ghost</a></div></div>
    </header>
    <div class="post-content">
      <p>In my previous post, <a href="http://www.mseri.me/ghost-on-amazon-ec2-without-using-sudo/">Ghost on Amazon EC2 without using sudo</a>, I was proposing some way of running ghost without having to use sudo and with at least a minimal eye on security.</p>
<p>If you have followed one of the guides that I suggested, namely <a href="https://blog.igbuend.com/dude-looks-like-a-ghost/">Dude Looks Like a Ghost</a>, or you have installed your own <a href="http://www.modsecurity.org">modsecurity</a> configuration you should have received a big page announcing an <strong>Error 403</strong> right after the update of your ghost to version <em>0.3.3</em>.</p>
<p><strong>Don&rsquo;t worry!</strong></p>
<p>Due to some security fixes in the last ghost version, modsecurity interpret the content of your ghost&rsquo;s <a href="http://en.wikipedia.org/wiki/HTTP_cookie">cookie</a> as an <a href="http://en.wikipedia.org/wiki/SQL_injection">sql injection</a> potential attack and simply drops the communication between the browser and the website to prevent it.</p>
<p>If I understood what expressjs/connect are doing under the hood, there should be no problem in dropping the rule that creates this false positive from the modsecrutiry configuration. The faster way (assuming that you don&rsquo;t need this rule somewhere else) is to comment it in the configuration file</p>
<pre><code>::sh
sed -i '/981246/s/^/# /' modsecurity_crs_41_sql_injection_attacks.conf
</code></pre>
<p>and then reload <a href="http://nginx.org">nginx</a></p>
<pre><code>::sh
/opt/nginx/sbin/nginx -s reload
</code></pre>
<p>Otherwise you should <a href="https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#secruleremovebyid">selectively remove</a> the rule for the subdomain that is pointing to your ghost instance. But I suppose that if you need this last configuration you already know how to do it&hellip;</p>

    </div>
    <div class="post-footer">
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    this.page.identifier = '8';
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "talesofafractalspectrum" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </article>

    </main>
  </body>
</html>
