<!doctype html><html lang=en-us>
<head>
<title>Move to ghc 7.8.2 on MacOSX // A fractal spectrum of tales</title>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.88.1">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Marcello Seri">
<meta name=description content="Free thoughts of a geeky mathematician">
<meta http-equiv=permissions-policy content="interest-cohort=()">
<link rel=stylesheet href=https://www.mseri.me/css/main.min.4e2016cf62779480fbe7ba44c261abc7b3a9744838af7268702179daa31e0716.css>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Move to ghc 7.8.2 on MacOSX">
<meta name=twitter:description content="Lately I&rsquo;ve been playing with some functional languages: haskell, lisp (in particular the scheme dialect, see e.g. chicken or racket) and elixir (I very much like it and I really appreciate that it runs on the erlang VM).
Each of those has something pretty unique and I believe is very worth learning. I cannot stress how much material you can find both online and in libraries to learn them (except for elixir but its website does a really good job and there will be plenty of books very soon out) and how strong thay can change your way of programming.">
<meta property="og:title" content="Move to ghc 7.8.2 on MacOSX">
<meta property="og:description" content="Lately I&rsquo;ve been playing with some functional languages: haskell, lisp (in particular the scheme dialect, see e.g. chicken or racket) and elixir (I very much like it and I really appreciate that it runs on the erlang VM).
Each of those has something pretty unique and I believe is very worth learning. I cannot stress how much material you can find both online and in libraries to learn them (except for elixir but its website does a really good job and there will be plenty of books very soon out) and how strong thay can change your way of programming.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.mseri.me/move-to-ghc-7-8-2-on-macosx/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2014-06-01T15:17:42+00:00">
<meta property="article:modified_time" content="2014-06-02T11:51:51+00:00">
</head>
<body>
<header class=app-header>
<a href=https://www.mseri.me><img class=app-header-avatar src=/images/gauss_logo.png alt="Marcello Seri"></a>
<h1>A fractal spectrum of tales</h1>
<p>Free thoughts of a geeky mathematician</p>
<div class=app-header-social>
<a target=_blank href=https://github.com/mseri rel="noreferrer noopener"><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a>
<a target=_blank href=https://twitter.com/marcelloseri rel="noreferrer noopener"><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a>
<a target=_blank href=https://academic.mseri.me rel="noreferrer noopener"><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-award"><title>award</title><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg></a>
</div>
</header>
<main class=app-container>
<article class=post>
<header class=post-header>
<h1 class=post-title>Move to ghc 7.8.2 on MacOSX</h1>
<div class=post-meta>
<div><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Jun 1, 2014
</div>
<div><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
6 min read
</div><div><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<a class=tag href=https://www.mseri.me/tags/tutorial/>tutorial</a><a class=tag href=https://www.mseri.me/tags/cabal/>cabal</a><a class=tag href=https://www.mseri.me/tags/setup/>setup</a><a class=tag href=https://www.mseri.me/tags/haskell/>haskell</a></div></div>
</header>
<div class=post-content>
<p>Lately I&rsquo;ve been playing with some functional languages: <a href=https://www.haskell.org/>haskell</a>, lisp (in particular the scheme dialect, see e.g. <a href=https://www.call-cc.org>chicken</a> or <a href=https://racket-lang.org>racket</a>) and <a href=https://elixir-lang.org>elixir</a> (I very much like it and I really appreciate that it runs on the erlang VM).</p>
<p>Each of those has something pretty unique and I believe is very worth learning. I cannot stress how much material you can find both online and in libraries to learn them (except for elixir but its website does a really good job and there will be plenty of books very soon out) and how strong thay can change your way of programming.</p>
<p>This post is about installing a recent version of <code>gch</code> to play with haskell.</p>
<p>I started using haskell by installing <code>ghc</code>, the Glasgow Haskell Compiler (pretty much the de fact standard of haskell compilers), via Homebrew. And then installing <code>haskell-platform</code> (again using Homebrew) to find out, not much later, that I only needed the <code>cabal-install</code> package (at that time installed via Homebrew too after removing the platform).</p>
<p>Recently, <code>ghc</code> reached version <code>7.8</code>, and that shipped a huge amount of improvements. With my huge disappointemnt, all the packages installed via Homebrew were supporting only ghc 7.6 and I had hard times with dependencies, multiple packages and so on&mldr;</p>
<p>The solution was pretty simple and straightforward in the end, and I believe this could be handy for other people too strognly enough to write this post.</p>
<p>First of all I uninstalled ghc 7.6, cabal-install or haskell platform (if you have it). Then I reinstalled the 7.8 branch of ghc, thanks to Homebrew that was pretty straightforward:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>    brew install ghc --devel
</code></pre></div><p>Additionally I had to remove the <code>.cabal</code> and <code>.ghc</code> folder in my home. There were pieces of configurations that were creating some conflicts, move them if you feel unsure and want to avoid the deletion.</p>
<p>Then I needed <code>cabal-install</code>. This requires slightly more work, especially it didn&rsquo;t quite work for me when I followed <a href=https://www.haskell.org/haskellwiki/Cabal-Install>the instructions</a>.</p>
<p>First download the sources for <code>cabal-install</code> from <a href=https://www.haskell.org/cabal/download.html>here</a>. Just the <code>cabal-install tool</code> sources, it is going to update the <code>Cabal</code> library during its setup.</p>
<p>Untar the file, e.g.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>    tar zxvf cabal-install-1.20.0.2.tar.gz
</code></pre></div><p>and enter the newly created folder, e.g</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>    cd cabal-install-1.20.0.2
</code></pre></div><p>Now it all reduces to run</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>    ./bootstrap.sh --no-doc
</code></pre></div><p>(append <code>--global</code> if you prefer to install it in <code>/usr/local</code> instead of <code>$HOME/cabal</code>).</p>
<p>The <code>--no-docs</code> flag seemed necessary to avoid a number of errors appearing in the compilation process and forcing me to install a number of packages by hand. Sadly I could not figure out the problem in the script yet, but that flag seems a reasonable workaround and I will install the docs later anyhow.</p>
<p>You may still get some error related to broken package, in such cas just <code>ghc-pkg unregister &lt;brokenpackagename></code> and rerun the script (in my case they were <code>text</code> and <code>mtl</code>).</p>
<p>When cabal is installed it is a good idea to run</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>    cabal update
</code></pre></div><p>and follow the instructions.</p>
<p>Remember that <code>.cabal/bin</code> must be in your <code>$PATH</code>.</p>
<p>To learn coding in haskell there are few great sources. I think <a href=https://learnyouahaskell.com>Learn yourself a Haskell for Great Good!</a> is a good place to start, maybe not perfect and not complete but I really really enjoied it (and learnt a lot).</p>
<h2 id=essential-packages-for-using-haskell>Essential Packages for Using Haskell</h2>
<p>Now, this section is mainly for my personal records. There is a number of packages I like to have installed for customizations, help and other stuff. Maybe some of those could interest some reader. Some of the installations will require sensible compilation times and overheating of your machine, it very much feels like installing <code>gentoo</code> ~10 years ago&mldr; some of you know what I mean :)</p>
<p>I rely very much on <a href=https://www.haskell.org/hoogle/>hoogle</a> when I code in haskell. Best part of it is that you can have it offline. First install the appropriate package with <code>cabal install hoogle</code>.</p>
<p>You may be get a warning and be asked to run the install with the flag <code>--force-reinstall</code>. Just do it: <code>cabal install hoogle --force-reinstall</code>.</p>
<p>I&rsquo;ve additionally got a strange error related to <code>happy</code> and <code>haskell-src-exts</code>, it can be solved just by <code>cabal install happy</code>. I am still wondering why it happened.</p>
<p>When the setup is complete, you can run <code>hoogle data</code> to create a local database of entries, or <code>hoogle data all</code> if you want the complete hoogle dataset (this takes a loooong time).</p>
<p>If you don&rsquo;t plan to use <code>goa</code> or <code>lambdabot</code> you can integrate <code>hoogle</code> in <code>ghci</code> by adding</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell>    <span style=color:#66d9ef>:</span>def hoogle <span style=color:#a6e22e>\</span>str <span style=color:#f92672>-&gt;</span> return <span style=color:#f92672>$</span> <span style=color:#e6db74>&#34;:! hoogle --count=15 </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>++</span> str <span style=color:#f92672>++</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>
</code></pre></div><p>to your <code>.ghci</code> file.</p>
<p>I believe that <code>ghci</code> is nothing without <a href=https://www.haskell.org/haskellwiki/Lambdabot>lambdabot</a>. Therefore <code>cabal install goa lambdabot</code> is the inevitable second step. Note that <code>goa</code> is not a mistake but a <a href=https://hackage.haskell.org/package/goa>useful addition</a>.</p>
<p><code>lambdabot &lt;= 4.3.0.1</code> have some problems with <code>ghc-7.8.2</code> and you will get a compilation error. To fix it you first <code>cabal install goa</code> by itself, then <code>cabal get lambdabot; cd lambdabot-4.3.0.1</code> and then you need to replace the content of <code>src/Lambdabot/Monad.hs-boot</code> with</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell>    <span style=color:#75715e>{-# LANGUAGE RankNTypes #-}</span>
    <span style=color:#66d9ef>module</span> Lambdabot.Monad <span style=color:#66d9ef>where</span>
</code></pre></div><pre><code>import Control.Monad.Reader
import Data.IORef

data IRCRWState
data IRCRState
newtype LB a = LB {runLB :: ReaderT (IRCRState, IORef IRCRWState) IO a} 

instance Monad LB
</code></pre>
<p>(the above code is due to <a href=https://github.com/mokus0/lambdabot/pull/79>artella-coding</a> and should be merged in the next release of lambdabot).
Then save and run <code>cabal configure && cabal install</code>.</p>
<p>Then in my <code>.ghci</code> I have</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell>    <span style=color:#66d9ef>:</span>m <span style=color:#f92672>-</span> <span style=color:#66d9ef>Prelude</span>
    <span style=color:#66d9ef>:</span>m <span style=color:#f92672>+</span> <span style=color:#66d9ef>GOA</span>
    setLambdabotHome <span style=color:#e6db74>&#34;/Users/marcelloseri/.cabal/bin&#34;</span>
    <span style=color:#66d9ef>:</span>def bs        lambdabot <span style=color:#e6db74>&#34;botsnack&#34;</span>
    <span style=color:#66d9ef>:</span>def pl        lambdabot <span style=color:#e6db74>&#34;pl&#34;</span>
    <span style=color:#66d9ef>:</span>def unpl      lambdabot <span style=color:#e6db74>&#34;unpl&#34;</span>
    <span style=color:#66d9ef>:</span>def redo      lambdabot <span style=color:#e6db74>&#34;redo&#34;</span>
    <span style=color:#66d9ef>:</span>def undo      lambdabot <span style=color:#e6db74>&#34;undo&#34;</span>
    <span style=color:#66d9ef>:</span>def index     lambdabot <span style=color:#e6db74>&#34;index&#34;</span>
    <span style=color:#66d9ef>:</span>def docs      lambdabot <span style=color:#e6db74>&#34;docs&#34;</span>
    <span style=color:#66d9ef>:</span>def instances lambdabot <span style=color:#e6db74>&#34;instances&#34;</span>
    <span style=color:#66d9ef>:</span>def hoogle    lambdabot <span style=color:#e6db74>&#34;hoogle&#34;</span>
    <span style=color:#66d9ef>:</span>def source    lambdabot <span style=color:#e6db74>&#34;fptools&#34;</span>
    <span style=color:#66d9ef>:</span>def <span style=color:#66d9ef>where</span>     lambdabot <span style=color:#e6db74>&#34;where&#34;</span>
    <span style=color:#66d9ef>:</span>def version   lambdabot <span style=color:#e6db74>&#34;version&#34;</span>
    <span style=color:#66d9ef>:</span>def src       lambdabot <span style=color:#e6db74>&#34;src&#34;</span>
</code></pre></div><p>I like to see what my code should look like. Often <a href=https://community.haskell.org/~ndm/hlint/>hlint</a> is of great help for this (especially when you run it directly in your favourite editor, e.g. <code>vim</code> and <code>Sublime Text</code>): thus <code>cabal install hlint</code>.</p>
<p>Ans speaking of editors we cannot forget <a href=https://www.mew.org/~kazu/proj/ghc-mod/en/ghc-mod.html>ghc-mod</a> to provide the integration: <code>cabal install ghc-mod</code>.</p>
<p>Finally I massively use <code>pandoc</code>, look at <a href=https://johnmacfarlane.net/pandoc/>its webpage</a> if you don&rsquo;t know it. You can installe prebuild binaries but recently I restarted enjying compiling things by myself. The installation via <code>cabal</code> is trivial. Just type <code>cabal install pandoc</code> and wait. Maybe go to get some coffee&mldr; it&rsquo;s not going to be just a couple of minutes. It may fail complaining about <code>alex</code>, in such case just run <code>cabal install alex</code> and run <code>cabal install pandoc</code> again.</p>
<p>Now that my <code>.cabal</code> folder is quite huge, I have everything I want to have fun with haskell.</p>
<p>I happen to use many more haskell packages in fact (e.g. <code>aeson</code> for the <code>json</code> integration) but I usually install them in <a href=https://www.haskell.org/cabal/users-guide/installing-packages.html#developing-with-sandboxes>local sandboxed environment</a> and try to keep the global user folder more or less stable.</p>
</div>
<div class=post-footer>
<script src=https://utteranc.es/client.js repo=mseri/mseri.github.io issue-term=pathname label=✨💬✨ theme=photon-dark crossorigin=anonymous async></script>
</div>
</article>
</main>
</body>
</html>