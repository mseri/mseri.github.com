<!doctype html><html lang=en-us>
<head>
<title>Shasumming files in ruby // A fractal spectrum of tales</title>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.89.4">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Marcello Seri">
<meta name=description content="Free thoughts of a geeky mathematician">
<meta http-equiv=permissions-policy content="interest-cohort=()">
<link rel=stylesheet href=https://www.mseri.me/css/main.min.4e2016cf62779480fbe7ba44c261abc7b3a9744838af7268702179daa31e0716.css>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Shasumming files in ruby">
<meta name=twitter:description content="Computing SHA-* hashes of files in ruby is in principle very easy.
You can either use the OpenSSL module or the digest one and the sytax is almost interchangeable. I am using the digest module just because it seems to be slightly faster (I timed it and on my machine it takes few milliseconds less).
My first code was
require 'digest' filename = '/path/to/the/file' Digest::SHA1.hexdigest(File.read(filename))  Then I made the hashes for a folder containing files of different sizes.">
<meta property="og:title" content="Shasumming files in ruby">
<meta property="og:description" content="Computing SHA-* hashes of files in ruby is in principle very easy.
You can either use the OpenSSL module or the digest one and the sytax is almost interchangeable. I am using the digest module just because it seems to be slightly faster (I timed it and on my machine it takes few milliseconds less).
My first code was
require 'digest' filename = '/path/to/the/file' Digest::SHA1.hexdigest(File.read(filename))  Then I made the hashes for a folder containing files of different sizes.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.mseri.me/shasumming-files-in-ruby/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2013-12-13T22:33:31+00:00">
<meta property="article:modified_time" content="2013-12-13T22:42:19+00:00">
</head>
<body>
<header class=app-header>
<a href=https://www.mseri.me><img class=app-header-avatar src=/images/gauss_logo.png alt="Marcello Seri"></a>
<h1>A fractal spectrum of tales</h1>
<p>Free thoughts of a geeky mathematician</p>
<div class=app-header-social>
<a target=_blank href=https://github.com/mseri rel="noreferrer noopener"><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a>
<a target=_blank href=https://twitter.com/marcelloseri rel="noreferrer noopener"><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a>
<a target=_blank href=https://academic.mseri.me rel="noreferrer noopener"><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-award"><title>award</title><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg></a>
</div>
</header>
<main class=app-container>
<article class=post>
<header class=post-header>
<h1 class=post-title>Shasumming files in ruby</h1>
<div class=post-meta>
<div><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Dec 13, 2013
</div>
<div><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
2 min read
</div><div><svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<a class=tag href=https://www.mseri.me/tags/trick/>trick</a></div></div>
</header>
<div class=post-content>
<p>Computing <a href=https://en.wikipedia.org/wiki/Sha1sum>SHA-* hashes</a> of files in ruby is in principle very easy.</p>
<p>You can either use the <code>OpenSSL</code> module or the <code>digest</code> one and the sytax is almost interchangeable. I am using the <code>digest</code> module just because it seems to be slightly faster (I timed it and on my machine it takes few milliseconds less).</p>
<p>My first code was</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>    require <span style=color:#e6db74>&#39;digest&#39;</span>
</code></pre></div><pre><code>filename = '/path/to/the/file'
Digest::SHA1.hexdigest(File.read(filename))
</code></pre>
<p>Then I made the hashes for a folder containing files of different sizes. For some reasones I checked them with <code>shasum</code> and with my great surprise I&rsquo;ve discovered that some hashes (namely the ones related to files bigger than few hundred megabytes) were wrong! Remarkably, the same happened with different SHA functions, and using <code>openssl</code>.</p>
<p>I don&rsquo;t really know why the problem happened, but <a href=https://www.ruby-forum.com/topic/180458>apparently the solution is fairly easy</a>. I am now using a variation of the script proposed in the previous link that seems to run pretty smoothly and got rid of the error:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>    require <span style=color:#e6db74>&#39;digest/sha1&#39;</span>
</code></pre></div><pre><code>filename = '/path/to/the/file'
buf = ''
d = Digest::SHA1.new
f = File.open(filename)

while not f.eof
  # reads the file in chunks of 65536 bytes
  f.read(65536, buf)
  d.update(buf)
end

d.hexdigest
</code></pre>
<p>I am using this long code just because it requires some milliseconds less than <code>Digest::SHA1.file(filename).hexdigest</code> to run (and this last is slightly faster than the <code>openssl</code> equivalent).</p>
<p>I hope it could be of help if you happen to have the same problem.</p>
</div>
<div class=post-footer>
<script src=https://utteranc.es/client.js repo=mseri/mseri.github.io issue-term=pathname label=âœ¨ðŸ’¬âœ¨ theme=photon-dark crossorigin=anonymous async></script>
</div>
</article>
</main>
</body>
</html>