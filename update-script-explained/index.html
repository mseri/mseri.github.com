<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="description" content="Tales of a Fractal Spectrum, ">

        <link rel="alternate" href="http://www.mseri.me/feed/atom.xml" type="application/atom+xml" title="Tales of a Fractal Spectrum Atom Feed"/>
        <link rel="alternate" href="http://www.mseri.me/feed/rss.xml" type="application/rss+xml" title="Tales of a Fractal Spectrum RSS Feed"/>

        <title>Update script explained - Tales of a Fractal Spectrum</title>



    <meta property="og:type" content="article" />
    <meta property="og:title" content="Update script explained" />
    <meta property="og:description" content="I am going to proceed step by step through the code of the script that I have posted few days ago. I purposedly updated the script to be a bit more general and flexible (but not too much). At the end of the file I explain how to run it ..." />

        <link rel="shortcut icon" href="http://www.mseri.me/images/gauss_logo.png" />

    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Open+Sans:700,400" />
    <link rel="stylesheet" href="http://www.mseri.me/theme/css/style-min.css">
    <!--<link rel="stylesheet" href="http://www.mseri.me/theme/css/pygments.css">-->

</head>
<body itemscope itemtype="http://schema.org/WebPage">
    <div class="pure-g-r" id="layout">
        <div class="sidebar pure-u">
            <header class="header">
                <hgroup>
                        <a id="blog-logo" href="http://www.mseri.me"><img src="http://www.mseri.me/images/gauss_logo.png" alt="Blog Logo" /></a>
                    <h1 itemprop="name" class="blog-title"><a href="http://www.mseri.me">Tales of a Fractal Spectrum</a></h1>
                        <h2 itemprop="description" class="blog-description">Free thoughts of a geeky mathematician</h2>
                </hgroup>
<nav class="nav">
  <ul class="social-list">
<li class="social-item"><a class="subscribe icon-twitter" href="http://www.twitter.com/marcelloseri" target="_blank"></a></li>&nbsp;<li class="social-item"><a class="subscribe icon-facebook" href="http://www.facebook.com/marcello.seri" target="_blank"></a></li>&nbsp;<li class="social-item"><a class="subscribe icon-google-plus" href="http://plus.google.com/+MarcelloSeri" target="_blank" rel="publisher"></a></li>&nbsp;<li class="social-item"><a class="subscribe icon-github" href="http://www.github.com/mseri" target="_blank"></a></li>&nbsp;    <li class="social-item">&nbsp;</li>
    <li class="social-item"><a class="subscribe icon-feed" href="http://www.mseri.me/feed/rss.xml" target="_blank"></a></li>
</ul>
</nav>
            </header>
            <footer class="footer">
                <section class="copyright">&copy; 2013--2015 <a itemscope="copyrightHolder" href="http://www.mseri.me">Tales of a Fractal Spectrum</a></section>
                <section class="poweredby">Proudly published with Pelican on GitHub Pages.</section> 
                <section class="theme"><a href="https://github.com/mseri/purity" target="_blank">Purity</a> is built with <a href="http://purecss.io" target="_blank">PureCSS</a>.</section>
            </footer>
            
        </div>
        <div class="pure-u-1 container">
            
<main class="content" role="main" id="top-post">
        <div class="back">
            <a href="http://www.mseri.me">&larr;  back to the home page</a>
        </div>

    <article itemscope itemtype="http://schema.org/Article" class="post purity_post">

        <header class="post-header">
            <h2 itemprop="name" class="post-title big">Update script explained</h2>
            <p class="post-meta">Written by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Marcello Seri</span></span> the <time itemprop="datePublished" datetime="21 Oct 2013">21 Oct 2013</time> - <span class="post-tagline"> under                                 <a class="post-category" href="http://www.mseri.me/tag/ghost.html">ghost</a>,                                 <a class="post-category" href="http://www.mseri.me/tag/update.html">update</a>,                                 <a class="post-category" href="http://www.mseri.me/tag/bash.html">bash</a>. </span></p>
        </header>

        <section class="post-content">

        <div class="post-share-box">
            <section class="share">
                <h3>Share this post</h3>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.mseri.me/update-script-explained/"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-twitter" href="http://twitter.com/share?text=Update script explained&url=http://www.mseri.me/update-script-explained/"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://www.mseri.me/update-script-explained/"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
        </div>

        <div itemprop="articleBody">
            <p>I am going to proceed step by step through the code of the script that I have <a href="http://www.mseri.me/a-simple-script-to-update-ghost/">posted few days ago</a>. </p>
<p>I purposedly updated the script to be a bit more general and flexible (but not too much). At the end of the file I explain how to run it. You should <a href="http://docs.ghost.org/installation/upgrading/">make a backup</a> before doing the update (the simplest way is probably running <code>tar czf backup.tar.gz YOUR_GHOST_FOLDER</code>). Be careful that there is no warranty with this script and I will not take any responsibility for claims or damages consequent to the use of it.</p>
<p>The following line is called <em>sha bang</em> and simply tells your system that the file contains a set of instructions that has to be executed by the <a href="http://en.wikipedia.org/wiki/Bash_(Unix_shell)"><em>bash</em></a> interpreter.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
</pre></div>
</td></tr></table>

<p>You should have bash installed in <code>/bin/bash</code> to be sure that the script will be of any use.</p>
<p>The next bit of code is just checking if you have defined the three most important variables: <code>GHOSTUPDATEFILE</code>, <code>GHOSTUPDATELOCATION</code>, <code>GHOSTINSTALLDIR</code>; and define them if they are not. They respectively represent the name of the last ghost update, at the present day it is just <code>ghost-0.3.3.zip</code>, the temporary folder that will be used to unzip the new ghost, by default <code>update-ghost-tmp</code> and the folder where ghost is installed (in this last version in absolute path), the default is the subfolder <code>ghost</code> of the folder containing the script.</p>
<div class="highlight"><pre><span class="x">if [[ -z </span><span class="p">$</span><span class="nv">GHOSTUPDATEFILE</span><span class="x"> ]];</span>
<span class="x">then</span>
<span class="x">  export GHOSTUPDATEFILE=&#39;ghost-0.3.3.zip&#39;</span>
<span class="x">fi</span>

<span class="x">if [[ -z </span><span class="p">$</span><span class="nv">GHOSTUPDATELOCATION</span><span class="x"> ]];</span>
<span class="x">then</span>
<span class="x">  export GHOSTUPDATELOCATION=&#39;update-ghost-tmp&#39;</span>
<span class="x">fi</span>

<span class="x">if [[ -z </span><span class="p">$</span><span class="nv">GHOSTINSTALLDIR</span><span class="x"> ]];</span>
<span class="x">then</span>
<span class="x">  export GHOSTINSTALLDIR=`pwd`&#39;/ghost&#39;</span>
<span class="x">fi</span>
</pre></div>


<p>You can either change them in the file or simply type something like the following before running the script in your terminal: <code>export NAME_OF_THE_VARIABLE='YOUR_CUSTOM_VALUE'</code></p>
<p>I suggest you to check that the variables are correct typing in your terminal <code>echo $NAME_OF_THE_VARIABLE</code> and checking that in output you get the correct <code>YOUR_CUSTOM_VALUE</code>.</p>
<p>The code proceed saving the current location in a variable, we will need it later, with </p>
<div class="highlight"><pre>export STARTLOCATION=`pwd`
</pre></div>


<p>The following three lines simply take care to download <code>GHOSTUPDATEFILE</code> and unzip it in <code>GHOSTUPDATELOCATION</code>.</p>
<div class="highlight"><pre><span class="x">wget http://ghost.org/zip/</span><span class="p">$(</span><span class="err">echo</span> <span class="p">$</span><span class="nv">GHOSTUPDATEFILE</span><span class="p">)</span><span class="x"></span>
<span class="x">unzip </span><span class="p">$</span><span class="nv">GHOSTUPDATEFILE</span><span class="x"> -d </span><span class="p">$</span><span class="nv">GHOSTUPDATELOCATION</span><span class="x"></span>
<span class="x">echo &quot;Ghost downloaded and unzipped&quot;</span>
</pre></div>


<p>For this step to be effective you need to have installed <code>wget</code>. If this is not the case you should install it or replace the wget line with</p>
<div class="highlight"><pre><span class="x">curl -O http://ghost.org/zip/</span><span class="p">$(</span><span class="err">echo</span> <span class="p">$</span><span class="nv">GHOSTUPDATEFILE</span><span class="p">)</span><span class="x"></span>
</pre></div>


<p>Note that you will anyhow read the message <em>Ghost downloaded and unzipped</em>, even if there have been errors during the execution. If I have time, I may change this behavior in a future version but I don't plan to do it for the moment.</p>
<div class="highlight"><pre><span class="x">cd </span><span class="p">$</span><span class="nv">GHOSTUPDATELOCATION</span><span class="x"></span>
<span class="x">cp *.md *.js *.txt *.json </span><span class="p">$</span><span class="nv">GHOSTINSTALLDIR</span><span class="x"></span>
<span class="x">cp -R core </span><span class="p">$</span><span class="nv">GHOSTINSTALLDIR</span><span class="x"></span>
<span class="x">cp -R content/themes/casper </span><span class="p">$</span><span class="nv">GHOSTINSTALLDIR</span><span class="x">/content/themes</span>
<span class="x">echo &quot;Ghost has been updated with&quot; </span><span class="p">$</span><span class="nv">GHOST</span><span class="x"></span>

<span class="x">cd </span><span class="p">$</span><span class="nv">GHOSTINSTALLDIR</span><span class="x"></span>
<span class="x">npm install --production</span>
<span class="x">echo &quot;NPM updated&quot;</span>
</pre></div>


<p>These few lines of code simply do what is mechanically suggested to do in the <a href="http://docs.ghost.org/installation/upgrading/">ghost upgrade instruction page</a>: go into the new ghost folder and copy all the files in your active ghost environment, then move back to your ghost environment and run npm update.</p>
<p>After this update process is finished, hopefully without errors, we go back to our first location and remove the temporary update file and update folder.</p>
<div class="highlight"><pre><span class="x">cd </span><span class="p">$</span><span class="nv">STARTLOCATION</span><span class="x"></span>
<span class="x">rm -rf </span><span class="p">$</span><span class="nv">GHOSTUPDATELOCATION</span><span class="x"> </span><span class="p">$</span><span class="nv">GHOSTUPDATEFILE</span><span class="x"></span>
<span class="x">echo &quot;Folder cleaned&quot;</span>
</pre></div>


<p>The next, last, step is the one that you will probably have to modify to adapt to your needs. Its purpose is restarting the ghost environment. In my case it runs with <a href="https://npmjs.org/package/forever">forever</a> and is started by a code that I saved in a script called <code>starter.sh</code> in my ghost folder. The following code does the restart as I would do it by hand and then tells me "<em>Done!</em>".</p>
<div class="highlight"><pre><span class="x">echo &quot;Restarting ghost...&quot;</span>
<span class="x">forever stop 0</span>
<span class="x">sh </span><span class="p">$</span><span class="nv">GHOSTINSTALLDIR</span><span class="x">/starter.sh</span>

<span class="x">echo &quot;Done!&quot;</span>
</pre></div>


<p>You have to replace those lines with the appropriate code. It really depends on how you start/stop your server, you can even delete them and do it by hand after the update is complete.</p>
<p>Suppose that your folder structure is something like</p>
<div class="highlight"><pre>~\
  folder1\
          ...
  folder2\
          ...
  folder3\
          myghost\
                ...
          folder5\
          update-ghost.sh
  folder4\
  ...
</pre></div>


<p>then to run the script you should log in to your server and do something like</p>
<div class="highlight"><pre>cd folder1/
export GHOSTINSTALLDIR=`pwd`&#39;/myghost&#39;
sh update-ghost.sh
</pre></div>


<p>I hope this is clear enough to give to everybody the chance to adapt the script and use a semiautomated way to update their ghost installation while we wait for some other official system.</p>
        </div>
        
        </section>

<section class="post-comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE UNCOMMENTING THE THEME * * */
    var disqus_shortname = 'talesofafractalspectrum'; // required: replace example with your forum shortname
    // make sure to use the post.id as an identifier, 
    //otherwise disqus will use the pages url per default, 
    //which might be problematic...
    var disqus_identifier = '10';

    /* * * DON'T EDIT BELOW THIS LINE * * */

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



    </article>
    
    <script type="text/javascript">
        document.getElementById( 'top-post' ).scrollIntoView();
    </script>

</main>
            
        </div>
    </div>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']]
    }
  });
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-44365202-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>